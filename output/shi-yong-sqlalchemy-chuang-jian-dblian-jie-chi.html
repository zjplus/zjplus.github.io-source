<!DOCTYPE html>
<html lang="zh">
<head>
          <title>zjlog is zj'blog</title>
        <meta charset="utf-8" />



</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">zjlog is zj'blog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/shi-yong-sqlalchemy-chuang-jian-dblian-jie-chi.html" rel="bookmark"
         title="Permalink to 使用 SQLAlchemy 创建DB连接池">使用 SQLAlchemy 创建DB连接池</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2017-11-02T17:59:00+08:00">
      四 02 十一月 2017
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/calvinzhang.html">calvin.zhang</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><strong>config.py</strong></p>
<div class="highlight"><pre><span></span><span class="n">db_config_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;drivername&quot;</span><span class="p">:</span> <span class="s2">&quot;mysql+pymysql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">3306</span><span class="p">,</span>
    <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;database&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;passwd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;charset&quot;</span><span class="p">:</span> <span class="s2">&quot;utf8&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><strong>main.py</strong></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">db_config_dict</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.engine.url</span> <span class="kn">import</span> <span class="n">URL</span>

<span class="k">class</span> <span class="nc">DatabaseConnect</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_config_dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="n">db_config_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">POOL_RECYCLE</span> <span class="o">=</span> <span class="mi">7200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">POOL_SIZE</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_OVERFLOW</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">POOL_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                                    <span class="n">pool_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">POOL_SIZE</span><span class="p">,</span>
                                    <span class="n">max_overflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_OVERFLOW</span><span class="p">,</span>
                                    <span class="n">pool_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">POOL_TIMEOUT</span><span class="p">,</span>
                                    <span class="n">pool_recycle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">POOL_RECYCLE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_conn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>


<h2>sqlalchemy.engine.url.URL详解</h2>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>